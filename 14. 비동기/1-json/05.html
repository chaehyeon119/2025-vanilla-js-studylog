<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <!-- 영화 목록을 보여줄 ul 요소 -->
    <ul id="movie-list"></ul>
    <script>
      // 🎯 이 예제의 목적: 서버에서 영화 데이터를 가져와서 화면에 목록으로 보여주기
      // 실제 웹사이트에서는 서버에서 상품 목록, 뉴스 기사, 사용자 정보 등을 가져와서 화면에 표시합니다
      // 이 예제는 fetch, async/await, DOM 조작을 모두 사용하는 실전 예제입니다

      // 즉시 실행 함수 (페이지 로드 시 바로 실행)
      (async () => {
        // 1. try-catch로 에러를 안전하게 처리하기
        try {
          // 2. 서버에서 JSON 파일 가져오기 (fetch)
          // fetch는 서버에 "data.json 파일을 주세요!"라고 요청하는 도구입니다
          // await는 "서버 응답이 올 때까지 기다려"라는 뜻입니다
          const res = await fetch("data.json");

          // 3. 서버 응답 상태 확인하기 (중요!)
          // res.ok는 서버 응답이 성공(200)인지 확인하는 속성입니다
          // true = 성공, false = 실패 (파일이 없거나 서버 오류)
          // 이 부분이 try 안에 있는 이유: 우리가 의도적으로 에러를 발생시키기 때문입니다
          if (!res.ok) {
            // 4. 의도적으로 에러를 발생시키기
            // throw는 "여기서 에러가 발생했다!"라고 알려주는 명령어입니다
            // 이렇게 하면 catch 블록으로 이동하여 에러를 처리할 수 있습니다
            throw new Error("에러 발생!");
          }

          // 5. 서버 응답을 JSON 형태로 변환하기
          // res.json()은 응답을 JavaScript 객체로 바꿔주는 도구입니다
          // await는 변환이 완료될 때까지 기다립니다
          const data = await res.json();

          // 6. HTML에서 영화 목록을 보여줄 요소 찾기
          // document.getElementById는 HTML에서 특정 id를 가진 요소를 찾는 도구입니다
          // "movie-list"는 위의 <ul> 태그의 id입니다
          const movieList = document.getElementById("movie-list");

          // 7. 데이터를 하나씩 꺼내서 화면에 표시하기
          // forEach는 배열의 각 항목을 하나씩 처리하는 도구입니다
          // data는 서버에서 가져온 영화 정보 배열입니다
          data.forEach((item) => {
            // 8. 새로운 li 요소 만들기
            // document.createElement는 새로운 HTML 요소를 만드는 도구입니다
            // "li"는 목록 항목을 나타내는 HTML 태그입니다
            const li = document.createElement("li");

            // 9. li 요소에 영화 정보를 HTML 형태로 넣기
            // innerHTML은 HTML 요소 안에 HTML 코드를 넣는 속성입니다
            // ${}는 JavaScript 변수를 HTML 안에 넣는 방법입니다
            li.innerHTML = `
      <p><strong>${item.title}</strong>(${item.year})</p>
      <p>감독: ${item.director}</p>
      `;

            // 10. 만든 li 요소를 화면의 ul 요소에 추가하기
            // append는 부모 요소에 자식 요소를 추가하는 도구입니다
            // movieList(ul)에 li를 추가하여 화면에 표시됩니다
            movieList.append(li);
          });
        } catch (err) {
          // 11. 에러가 발생했을 때 실행될 코드
          // err는 어떤 에러가 발생했는지 알려주는 정보입니다
          // console.error는 에러를 콘솔에 빨간색으로 출력하는 도구입니다
          console.error(err);
          console.log("catch문 에러", err);
        }
      })(); // ← 여기서 함수를 즉시 실행!

      // 📚 if(!res.ok)가 try 안에 있는 이유:
      // 1. 우리가 의도적으로 에러를 발생시키기 때문입니다
      // 2. res.ok가 false일 때 throw로 에러를 만들어서 catch 블록으로 보냅니다
      // 3. 이렇게 하면 서버 오류와 네트워크 오류를 모두 catch에서 처리할 수 있습니다
      // 4. 만약 if(!res.ok)를 try 밖에 두면, throw가 catch로 가지 않고 프로그램이 멈춥니다
      // 5. try-catch는 "예상 가능한 에러"를 안전하게 처리하기 위한 도구입니다
    </script>
  </body>
</html>
